<%= render template: "layouts/user_time_analytics" %>
<br>
<h2> User Time Activity Monthly Report</h2>

<%=  form_tag controller: 'user_time_checks', action: 'user_time_activity_report_monthly' do %>

  <table>
    <tr align="left">
      <th><%= "Date From"%></th>
    </tr>  
    <tr align="left">
      <td><%= text_field_tag "date_from",
          (params[:date_from]) || Date.today - 1.month %>
        <%= calendar_for 'date_from' %>
      </td>    
    </tr>
    <tr align="left">
      <th><%=" Date To" %></th>
    </tr>
    <tr align="left">
      <td> <%= text_field_tag "date_to",
          (params[:date_to]) ||Date.today %> 
        <%= calendar_for 'date_to' %>
      </td>    
    </tr>
  </table>

  <br><br>

  <table border="1" id='user-time-activity-report'>
    <thead>
      <tr align="center">
        <th><%= "User Name " %></th>
        <th><%= "Missed due dates " %></th>
        <th><%= "Month " %></th>
        <th><%= "Year " %></th>
        <% unless @trackers.nil? ||  @trackers.empty? %>
          <% @trackers.each do |tracker| %>


            <th><%= " Num of "+tracker.name+" Handled"%></th> 
            <th><%= "time Spent on "+tracker.name %></th>
          <%end%>
        <%end%>
      </tr>
    </thead>
    <tbody>


      <% unless   @months_and_years.nil? ||    @months_and_years.empty? %> 
        <%i=0%>
        <%   @months_and_years.each do |user| %>
          <tr  align="center" >


            <td>
              <%= user.user_id%>
            </td> 
            <td>
              <% a = @time_missed_dates[i] %>
              <% if  a.nil? ||    a.empty? ||a.blank? %>
                <%="Missed dates "+a.missed_dates.to_s   %>
              <% else %>
                <%="0"  %>
              <% end %>
            </td> 
            <!-- RND -->

            <td>
              <%= user.month%>
            </td> 
            <td>
              <%= user.year%>
            </td> 
            <td>
              <% t = @time_rnd[i] %>
              <% unless  t.nil? ||    t.empty? ||t.blank? %>
                <%=t[0].num_of_trackers.to_s   %>
              <% else %>
                <%="0"  %>
              <% end %>
            </td> 
            <td>
              <% unless  t.nil? ||    t.empty? ||t.blank? %>
                <%= t[0].time_spent.to_s if t %>
              <% else %>
                <%="0"  %>
              <% end %>
            </td>

            <!-- BUG -->

            <td>
              <% t = @time_bug[i] %>
              <% unless  t.nil? ||    t.empty? ||t.blank? %>
                <%=t[0].num_of_trackers.to_s   %>
              <% else %>
                <%="0"  %>
              <% end %>
            </td> 
            <td>
              <% unless  t.nil? ||    t.empty? ||t.blank? %>
                <%= t[0].time_spent.to_s if t %>
              <% else %>
                <%="0"  %>
              <% end %>
            </td>
            <!-- ENHANCEMENT -->


            <td>
              <% t = @time_enhancement[i] %>
              <% unless  t.nil? ||    t.empty? ||t.blank? %>
                <%t[0].num_of_trackers.to_s   %>
              <% else %>
                <%="0"  %>
              <% end %>
            </td> 
            <td>
              <% unless  t.nil? ||    t.empty? ||t.blank? %>
                <%= t[0].time_spent.to_s if t %>
              <% else %>
                <%="0"  %>
              <% end %>
            </td>

          </tr> 
          <%i=i+1%>

        <%end%>
      <% end %>




    </tbody>
  </table>

  <%= submit_tag 'Apply' %>
<% end %>



























